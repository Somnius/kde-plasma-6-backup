#!/bin/bash

###############################################################################
# KDE Plasma 6 Backup/Restore Wrapper Script
# 
# This is the main entry point for all backup/restore operations.
# It delegates to the appropriate internal scripts.
#
# Usage:
#   ./kde-backup backup [OPTIONS]
#   ./kde-backup restore BACKUP_DIR [OPTIONS]
#   ./kde-backup validate BACKUP_DIR
###############################################################################

set -euo pipefail

# Get script directory
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

# Colors for output
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

# Show usage
show_usage() {
    echo "KDE Plasma 6 Backup and Restore Tool"
    echo ""
    echo "Usage:"
    echo "  $0 backup [OPTIONS]"
    echo "  $0 restore BACKUP_DIR [OPTIONS]"
    echo "  $0 validate BACKUP_DIR"
    echo ""
    echo "Commands:"
    echo "  backup    - Create a backup of KDE Plasma 6 settings"
    echo "  restore   - Restore KDE Plasma 6 settings from a backup"
    echo "  validate  - Validate a backup's integrity and compatibility"
    echo ""
    echo "For detailed help on each command:"
    echo "  $0 backup --help"
    echo "  $0 restore --help"
    echo "  $0 validate --help"
    echo ""
    echo "Examples:"
    echo "  $0 backup"
    echo "  $0 validate backup-20250104-120000"
    echo "  $0 restore backup-20250104-120000 --skip-display-config"
}

# Check if command is provided
if [[ $# -eq 0 ]]; then
    show_usage
    exit 1
fi

COMMAND="$1"
shift

# Route to appropriate script
case "$COMMAND" in
    backup)
        exec "${SCRIPT_DIR}/kb-backup.sh" "$@"
        ;;
    restore)
        exec "${SCRIPT_DIR}/kb-restore.sh" "$@"
        ;;
    validate)
        exec "${SCRIPT_DIR}/kb-validate.sh" "$@"
        ;;
    help|--help|-h)
        show_usage
        exit 0
        ;;
    *)
        echo -e "${RED}Error: Unknown command '${COMMAND}'${NC}" >&2
        echo ""
        show_usage
        exit 1
        ;;
esac

